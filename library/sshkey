#!/usr/bin/python

import os

def main():
    module = AnsibleModule(
       argument_spec = dict(
           dest=dict(type='str', required=True),
           state=dict(type='str', choices=['absent', 'present'], default='present'),
       ),
    )

    changed = False
    sshkeygen = module.get_bin_path('ssh-keygen', True)

    dest = module.params['dest']

    if module.params['state'] == 'present':
        if not os.path.exists(dest):
            module.run_command('%s -f %s -N ""'%(sshkeygen, dest))
            changed=True

    if module.params['state'] == 'absent':
        if os.path.exists(dest):
            os.remove(dest)
            changed = True

    module.exit_json(changed=changed)


# this is magic, see lib/ansible/module_common.py
#<<INCLUDE_ANSIBLE_MODULE_COMMON>>
main()
