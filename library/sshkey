#!/usr/bin/python

import os

def main():
    module = AnsibleModule(
       argument_spec = dict(
           dest=dict(type='str', required=True),
           state=dict(type='str', choices=['absent', 'present'], default='present'),
       ),
       add_file_common_args=True,
       supports_check_mode=True,
    )

    changed = False
    sshkeygen = module.get_bin_path('ssh-keygen', True)

    dest = module.params['dest']


    if module.params['state'] == 'present':
        if not os.path.exists(dest):
            if module.check_mode:
                module.exit_json(changed=True)
            module.run_command('%s -f %s -N ""'%(sshkeygen, dest))
            changed=True

        file_args = module.load_common_arguments(module.params)

        changed = module.set_fs_attributes_if_different(file_args, changed)

    if module.params['state'] == 'absent':
        if os.path.exists(dest):
            if not module.check_mode:
                os.remove(dest)
            changed = True

    module.exit_json(changed=changed)


# this is magic, see lib/ansible/module_common.py
#<<INCLUDE_ANSIBLE_MODULE_COMMON>>
main()
